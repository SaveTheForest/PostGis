CREATE EXTENSION postgis;

CREATE TABLE pontos (
id SERIAL PRIMARY KEY,
nome varchar(20),
geom geometry(Point, 4326)
);
INSERT INTO pontos (nome, geom) VALUES
('Ponto 1', ST_SetSRID(ST_MakePoint(-43.947, -19.917), 4326)),
('Ponto 2', ST_SetSRID(ST_MakePoint(-43.943, -19.915), 4326)),
('Ponto 3', ST_SetSRID(ST_MakePoint(-43.948, -19.916), 4326));

SELECT nome, ST_AsText(geom), ST_Distance(geom, ST_SetSRID(ST_MakePoint(-43.946, -
19.917), 4326)) AS distancia
FROM pontos
WHERE ST_DWithin(geom, ST_SetSRID(ST_MakePoint(-43.946, -19.917), 4326), 0.001);

CREATE TABLE cidades (
id SERIAL PRIMARY KEY,
nome varchar(50),
populacao bigint,
geom geometry(MultiPolygon, 4326)
);
INSERT INTO cidades(nome, populacao, geom) VALUES
('São Paulo', 12325232, ST_SetSRID(ST_GeomFromText('MULTIPOLYGON(((
-46.826171875 -23.6474988338,
-46.7724609375 -23.6474988338,
-46.7724609375 -23.5923936566,
-46.826171875 -23.5923936566,
-46.826171875 -23.6474988338)))'), 4326)),
('Rio de Janeiro', 6747815, ST_SetSRID(ST_GeomFromText('MULTIPOLYGON(((
-43.4240722656 -22.9973093535,
-43.1756591797 -22.9973093535,
-43.1756591797 -22.7847896349,
-43.4240722656 -22.7847896349,
-43.4240722656 -22.9973093535)))'), 4326)),
('Belo Horizonte', 2521564, ST_SetSRID(ST_GeomFromText('MULTIPOLYGON(((
-44.0814208984 -19.9100001913,
-43.9739990234 -19.9100001913,
-43.9739990234 -19.8324514855,
-44.0814208984 -19.8324514855,
-44.0814208984 -19.9100001913)))'), 4326)),
('Recife', 1645727, ST_SetSRID(ST_GeomFromText('MULTIPOLYGON(((
-34.926071 -8.053740,
-34.864807 -8.053740,
-34.864807 -7.994952,
-34.926071 -7.994952,
-34.926071 -8.053740)))'), 4326)),
('Olinda', 391086, ST_SetSRID(ST_GeomFromText('MULTIPOLYGON(((
-34.858246 -8.005430,
-34.832729 -8.005430,
-34.832729 -7.971742,
-34.858246 -7.971742,
-34.858246 -8.005430)))'), 4326)),
('Paulista', 334184, ST_SetSRID(ST_GeomFromText('MULTIPOLYGON(((
-34.849486 -7.928359,
-34.811264 -7.928359,
-34.811264 -7.892192,
-34.849486 -7.892192,
-34.849486 -7.928359)))'), 4326));

SELECT nome, ST_AsText(geom)
FROM cidades
WHERE ST_DWithin(geom, (SELECT geom FROM cidades WHERE nome = 'São Paulo' LIMIT 1), 50000);

